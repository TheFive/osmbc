include mixins




mixin firstBlogOfList(list,count,c)
  - if (!count) count = 1
  if (list.length > 0)
    each blog,i in list
      if i<count
        li
          a.nav-link(href=`${layout.htmlroot}/blog/${blog.name}`)=blog.name
            span.badge.osmbcbadge-lang=blogNumber(blog, layout.language)
            if layout.language2
              span.badge.osmbcbadge-lang2=blogNumber(blog, layout.language2)

mixin collectMenu
  if (layout && layout.user.access === "full")
    li.navbar-item.active
      a.nav-link#collect(href=htmlroot + '/article/create') Collect
  else
    li.navbar-item.active
      a.nav-link#collect(href=htmlroot + '/article/create') Submit Link

mixin myGuestArticleMenu
  if (layout && layout.user.access === "guest")
    li.navbar-item.active
      ul.nav.navbar-nav.pull-left
        li
          a.nav-link#myArticles(href=htmlroot + '/osmbc.html') My Articles


mixin tbcMenu
  if (layout && layout.user.access === "full")
    li.navbar-item.active
      if blogNumber(layout.tbc, layout.language) > 0
        - dynamicHide = ""
        if (layout.tbc._tbcOwnArticleNumber == 0)
          - dynamicHide = "hidden-xs"
        ul.nav.navbar-nav.pull-left(class=dynamicHide)
          li.nav-item
            a.nav-link(href=layout.htmlroot+'/blog/TBC')=layout.tbc.name
              if (layout.tbc._tbcOwnArticleNumber > 0)
                span.badge.osmbcbadge-user=layout.tbc._tbcOwnArticleNumber

mixin inboxMenu
  li.navbar-item.active
     a.nav-link#inbox(href=layout.htmlroot + '/usert/inbox')="Inbox "
       if (layout.userMentions > 0)
         span.badge.osmbcbadge-user=layout.userMentions
       if (layout.user.access === "full")
         if (layout.mainLangMentions > 0)
           span.badge.osmbcbadge-lang=layout.mainLangMentions
         if (layout.secondLangMentions > 0)
           span.badge.osmbcbadge-lang2=layout.secondLangMentions

mixin articleMenu
  li#article.dropdown
    a.dropdown-toggle(href='#', data-toggle='dropdown')
      | Lists
      span.caret
    ul.dropdown-menu(role='menu')
      li.dropdown-header Articles
      li
        a(href=layout.htmlroot + '/article/search') Search
        a(href=layout.htmlroot + '/article/list?myArticles=true') My Empty Collections
      li.dropdown-header Orphaned Article

        li
          a(href=layout.htmlroot + '/article/list?blog=Trash') Trash
        li
          a(href=layout.htmlroot + '/article/list?blog=TBC') TBC
        li
          a(href=layout.htmlroot + '/article/list?blog=Future') Future
        li
          a(href=layout.htmlroot + '/article/list?blog=') No Blog

mixin toolMenu
  li.dropdown#tool.hidden-xs
    a.dropdown-toggle(href='#', data-toggle='dropdown')
      | Tool
      span.caret
    ul.dropdown-menu(role='menu')
      li.dropdown-header Markdown Helper
      li
        a(href=layout.htmlroot + "/tool/picturetool") Picture Tool
      if (layout.scriptUser === "full" || (Array.isArray(layout.scriptUser) && layout.scriptUser.indexOf(layout.user.OSMUser)>=0))
        li.divider
        li.dropdown-header="Script Plugins (TEST PHASE)"
          li
            a(href=layout.htmlroot + "/tool/scripts/execute")="Execute Scripts"
          li
            a(href=layout.htmlroot + "/tool/scripts/log")="Script Results"

      li.divider
      li.dropdown-header Editorial Tools
        li
          a(href="https://mattermost.openstreetmap.de") Mattermost for Editorial Team


      li.divider
      li.dropdown-header About The Team
        li
          a(href="https://docs.google.com/spreadsheets/d/1LAoVqxf3GkE3a-P6zmrT7_D-Q7SMIAFXoK4MizoMThM/edit?usp=sharing") Google List of Skills





block all
  doctype html
  html(lang='en')
    head
      meta(charset='utf-8')
      meta(name='viewport', content='width=device-width, initial-scale=1')
      meta(name='description', content='')
      meta(name='author', content='')
      link(rel='icon', href='/favicon.ico')
      title=(layout)?layout.title:appName
      // Bootstrap core CSS
      link(href=path("bootstrap")+'/css/bootstrap.min.css', rel='stylesheet')
      link(href=path("font-awesome")+"/css/font-awesome.min.css" rel='stylesheet')

    body
      - function blogNumber(blog,language) {return ((blog && blog._countUneditedMarkdown)?blog._countUneditedMarkdown[language]:"?") }
      - function blogCount(blog,language) {return ((blog && blog._countExpectedMarkdown)?blog._countExpectedMarkdown[language]:"?") }


      // Fixed navbar
      nav.navbar.navbar-light.bg-light.navbar-expand-lg.fixed-top
        - var listall = []
        if (layout)
          - listall = [].concat(layout.listOfReviewBlog)
          - listall = listall.concat(layout.listOfEditBlog)
          - listall = listall.concat(layout.listOfOpenBlog)

        +homeButton("navbar-brand")
        button.navbar-toggler(type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation")
          span.navbar-toggler-icon
        div.collapse.navbar-collapse#navbarSupportedContent
          ul.navbar-nav.mr-auto
      
            +collectMenu
            +tbcMenu
            +inboxMenu
            +myGuestArticleMenu
            if (layout && layout.user.access === "full")
              li.navbar-item.active
                +firstBlogOfList(listall,2)
            block additionalMenu    
          ul.navbar-nav
            li.navbar-item.active
              +helpMenu
            +langChooser("lang")
            +langChooser("lang2")
            - for (i = 3; params && params.columns && i<= params.columns;i++)
              +langChooser("lang"+i)
            +userAvatar


            // /.nav-collapse


      .container-fluid
        if (layout && layout.user && layout.user.emailInvalidation)
          p
            div.alert.alert-danger.text-center#mailalert
              p="Waiting for email verification, have a look at the email with the title '[OSMBC] Welcome to OSMBC' in your inbox."
              p
                a.alert-link(href=layout.htmlroot+"/usert/self")=" Goto User Configuration"
        if (layout && layout.user && !layout.user.email && !layout.user.emailInvalidation)
          p
            div.alert.alert-danger.text-center#mailalert
              p="Please enter your email to receive comments and feedback here:"
              p
                a.alert-link(href=layout.htmlroot + "/usert/self")=" Goto User Configuration"

        p
         block content
        p

      // /container

      // Bootstrap core JavaScript
      // ==================================================
      // Placed at the end of the document so the pages load faster
      script(src=path("jquery")+'/jquery.min.js')
      script(src=path("bootstrap")+'/js/bootstrap.bundle.min.js')

  doctype html
  html
    head
      title= title
      link(rel='stylesheet', href=`${htmlroot}${stylesheet}`)
    body
  script(nonce=cspNonce).

    // Init This Window with jQuery ready Callback
    $(document).ready(init2);
    function init2() {
      $("#mailalert").animate({height: '200px',fontSize: "40px"},1000)
    }
    function chooseLanguage(number,lang) {
      var data = {};
      data[number]=lang;
      jQuery.post("!{htmlroot}/language",data, function () {
        location.reload();
      }).fail(function (err) {
        console.error("Problem changing language " +  number + " " + lang);
        console.error(err);
      });
    }
    function setUserConfig(options) {
      jQuery.post("!{htmlroot}/setuserconfig/",options, function (data) {
        location.reload();
      }).fail(function (err) {
        console.error("Trouble saveing User Config");
        console.error(err);
      });
    }   

  block scripts
